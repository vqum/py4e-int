(self.webpackChunkWebComponents=self.webpackChunkWebComponents||[]).push([[611],{2568:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var s=i(21294);class o{constructor(e){this.component_ready_promise=new Promise((e=>this._component_ready_resolve_fn=e)),this.optional=!1,void 0===window.allComponents&&(window.allComponents=[]),window.allComponents.push(this),e&&(this.sid=e.sid,this.graderactive=e.graderactive,this.showfeedback=!0,e.timed&&(this.isTimed=!0),e.enforceDeadline&&(this.deadline=e.deadline),$(e.orig).data("optional")?this.optional=!0:this.optional=!1,e.selector_id&&(this.selector_id=e.selector_id),void 0!==e.assessmentTaken?this.assessmentTaken=e.assessmentTaken:this.assessmentTaken=!0,void 0!==e.timedWrapper?this.timedWrapper=e.timedWrapper:location.href.indexOf("doAssignment")>=0?this.timedWrapper=$("h1#assignment_name").text():this.timedWrapper=null,$(e.orig).data("question_label")&&(this.question_label=$(e.orig).data("question_label"))),this.jsonHeaders=new Headers({"Content-type":"application/json; charset=utf-8",Accept:"application/json"})}async logBookEvent(e){if(this.graderactive)return;let t;return e.course=eBookConfig.course,e.clientLoginStatus=eBookConfig.isLoggedIn,e.timezoneoffset=(new Date).getTimezoneOffset()/60,this.percent&&(e.percent=this.percent),eBookConfig.useRunestoneServices&&eBookConfig.logLevel>0&&(t=this.postLogMessage(e)),this.isTimed&&!eBookConfig.debug||console.log("logging event "+JSON.stringify(e)),this.selector_id&&(e.div_id=this.selector_id.replace("-toggleSelectedQuestion",""),e.event="selectquestion",e.act="interaction",this.postLogMessage(e)),"function"==typeof s.j.updateProgress&&"edit"!=e.act&&0==this.optional&&s.j.updateProgress(e.div_id),t}async postLogMessage(e){var t;let i=new Request(eBookConfig.ajaxURL+"hsblog",{method:"POST",headers:this.jsonHeaders,body:JSON.stringify(e)});try{let e=await fetch(i);if(!e.ok)throw new Error("Failed to save the log entry");t=e.json()}catch(e){this.isTimed&&alert(`Error: Your action was not saved! The error was ${e}`),console.log(`Error: ${e}`)}return t}async logRunEvent(e){let t="done";if(!this.graderactive){if(e.course=eBookConfig.course,e.clientLoginStatus=eBookConfig.isLoggedIn,e.timezoneoffset=(new Date).getTimezoneOffset()/60,(this.forceSave||"to_save"in e==0)&&(e.save_code="True"),eBookConfig.useRunestoneServices&&eBookConfig.logLevel>0){let i=new Request(eBookConfig.ajaxURL+"runlog.json",{method:"POST",headers:this.jsonHeaders,body:JSON.stringify(e)}),s=await fetch(i);if(!s.ok)throw new Error("Failed to log the run");t=await s.json()}return this.isTimed&&!eBookConfig.debug||console.log("running "+JSON.stringify(e)),"function"==typeof s.j.updateProgress&&0==this.optional&&s.j.updateProgress(e.div_id),t}}async checkServer(e,t=!1){let i=this;if(this.checkServerComplete=new Promise((function(e,t){i.csresolver=e})),this.useRunestoneServices||this.graderactive){let t={};if(t.div_id=this.divid,t.course=eBookConfig.course,t.event=e,this.graderactive&&this.deadline&&(t.deadline=this.deadline,t.rawdeadline=this.rawdeadline,t.tzoff=this.tzoff),this.sid&&(t.sid=this.sid),!eBookConfig.practice_mode&&this.assessmentTaken){let e=new Request(eBookConfig.ajaxURL+"getAssessResults",{method:"POST",body:JSON.stringify(t),headers:this.jsonHeaders});try{let i=await fetch(e);t=await i.json(),this.repopulateFromStorage(t),this.csresolver("server")}catch(e){try{this.checkLocalStorage()}catch(e){console.log(e)}}}else this.loadData({}),this.csresolver("not taken")}else this.checkLocalStorage(),this.csresolver("local");t&&this.indicate_component_ready()}indicate_component_ready(){this.containerDiv.classList.add("runestone-component-ready"),this._component_ready_resolve_fn()}loadData(e){return null}repopulateFromStorage(e){null!==e&&this.shouldUseServer(e)?(this.restoreAnswers(e),this.setLocalStorage(e)):this.checkLocalStorage()}shouldUseServer(e){if("T"===e.correct||0===localStorage.length||!0===this.graderactive||this.isTimed)return!0;let t,i=localStorage.getItem(this.localStorageKey());if(null===i)return!0;try{t=JSON.parse(i)}catch(e){return console.log(e.message),localStorage.removeItem(this.localStorageKey()),!0}if(e.answer==t.answer)return!0;let s=new Date(t.timestamp);return new Date(e.timestamp)>=s}localStorageKey(){return eBookConfig.email+":"+eBookConfig.course+":"+this.divid+"-given"}addCaption(e){if(!this.isTimed){var t=document.createElement("p");this.question_label?(this.caption=`Activity: ${this.question_label} ${this.caption}  <span class="runestone_caption_divid">(${this.divid})</span>`,$(t).html(this.caption),$(t).addClass(`${e}_caption`)):($(t).html(this.caption+" ("+this.divid+")"),$(t).addClass(`${e}_caption`),$(t).addClass(`${e}_caption_text`)),this.capDiv=t,this.containerDiv.appendChild(t)}}hasUserActivity(){return this.isAnswered}checkCurrentAnswer(){console.log("Each component should provide an implementation of checkCurrentAnswer")}async logCurrentAnswer(){console.log("Each component should provide an implementation of logCurrentAnswer")}renderFeedback(){console.log("Each component should provide an implementation of renderFeedback")}disableInteraction(){console.log("Each component should provide an implementation of disableInteraction")}toString(){return`${this.constructor.name}: ${this.divid}`}queueMathJax(e){"2"===MathJax.version.substring(0,1)?MathJax.Hub.Queue(["Typeset",MathJax.Hub,e]):MathJax.typesetPromise([e])}}window.RunestoneBase=o},60611:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__);var _common_js_runestonebase__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2568),jexcel__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(27010),jexcel__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(jexcel__WEBPACK_IMPORTED_MODULE_1__);window.ssList={};class SpreadSheet extends _common_js_runestonebase__WEBPACK_IMPORTED_MODULE_0__.Z{constructor(opts){super(opts);let orig=opts.orig;this.div_id=orig.id,this.sheet_id=`${this.div_id}_sheet`,this.data=eval(`${this.div_id}_data`),this.autograde=$(orig).data("autograde"),this.suffix=window[`${this.div_id}_asserts`],this.mindimensions=$(orig).data("mindimensions"),this.colwidths=$(orig).data("colwidths"),this.coltitles=eval($(orig).data("coltitles")),this.maxHeight=50,this.renderSheet(),this.autograde&&(this.addAutoGradeButton(),this.addOutput()),this.caption="Spreadsheet",this.divid=this.div_id,this.containerDiv=document.getElementById(this.div_id),this.addCaption("runestone"),this.indicate_component_ready()}renderSheet(){let e=document.getElementById(this.sheet_id),t={data:this.data,tableHeight:this.maxHeight};if(this.mindimensions&&(t.minDimensions=this.mindimensions),t.columns=[],this.colwidths)for(let e of this.colwidths)t.columns.push({width:e});if(this.coltitles)for(let e in this.coltitles)t.columns[e]?t.columns[e].title=unescape(this.coltitles[e]):t.columns.push({title:this.coltitles[e]});if(this.table=jexcel__WEBPACK_IMPORTED_MODULE_1___default()(e,t),this.suffix)for(let e of this.suffix){let t,i,s,o;[t,i,s,o]=e.split(/\s+/),$(`#${this.div_id}_sheet`).find(this.getCellSelector(i)).css("background-color","#d4e3ff")}}addAutoGradeButton(){let e=document.getElementById(this.div_id);var t=document.createElement("button");$(t).text("Check"),$(t).addClass("btn btn-success run-button"),e.appendChild(t),this.gradeButton=t,$(t).click(this.doAutoGrade.bind(this)),$(t).attr("type","button"),$(t).css("display","block")}addOutput(){this.output=document.createElement("pre"),this.output.id=`${this.div_id}_stdout`,$(this.output).css("visibility","hidden"),document.getElementById(this.div_id).appendChild(this.output)}doAutoGrade(){let e=this.suffix;this.passed=0,this.failed=0;let t="";e=e.filter((function(e){return e.indexOf("assert")>-1}));for(let i of e){let e,s,o,n;[e,s,o,n]=i.split(/\s+/),t+=this.testOneAssert(s,o,n),t+="\n"}let i=100*this.passed/(this.passed+this.failed);i=i.toLocaleString(void 0,{maximumFractionDigits:2}),t+=`You passed ${this.passed} out of ${this.passed+this.failed} tests for ${i}%`,this.logBookEvent({event:"unittest",div_id:this.div_id,course:eBookConfig.course,act:`percent:${i}:passed:${this.passed}:failed:${this.failed}`}),$(this.output).css("visibility","visible"),$(this.output).text(t)}testOneAssert(e,t,i){let s=this.getCellDisplayValue(e),o="";return{"==":function(e,t){return e==t},"!=":function(e,t){return e!=t},">":function(e,t){return e>t},"<":function(e,t){return e>t}}[t](s,i)?(o=`Pass: ${s} ${t} ${i} in ${e}`,$(`#${this.div_id}_sheet`).find(this.getCellSelector(e)).css("background-color","#ccffcc"),this.passed++):(o=`Failed ${s} ${t} ${i} in cell ${e}`,$(`#${this.div_id}_sheet`).find(this.getCellSelector(e)).css("background-color","#ff9980"),this.failed++),o}getCellSource(e){return this.table.getValue(e)}getCellDisplayValue(e){return this.table.el.querySelector(this.getCellSelector(e)).innerText}getCellSelector(e){let t=e.match(/\$?([A-Z]+)\$?([0-9]+)/);return`[data-x="${this.columnToIndex(t[1])}"][data-y="${t[2]-1}"]`}columnToIndex(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZ",i=0;for(let s=0,o=e.length-1;s<e.length;s+=1,o-=1)i+=Math.pow(t.length,o)*(t.indexOf(e[s])+1);return i-1}}$(document).bind("runestone:login-complete",(function(){$("[data-component=spreadsheet]").each((function(e){var t={orig:this,useRunestoneServices:eBookConfig.useRunestoneServices};try{window.ssList[this.id]=new SpreadSheet(t)}catch(e){console.log(`Error rendering SpreadSheet Problem ${this.id}\n                         Details: ${e}`),console.log(e.stack)}}))})),void 0===window.component_factory&&(window.component_factory={}),window.component_factory.spreadsheet=function(e){return new SpreadSheet(e)}}}]);
//# sourceMappingURL=611.bundle.js.map?v=d28aa28b84170aadc62e