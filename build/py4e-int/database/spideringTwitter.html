<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>21.6. Spidering Twitter using a database &#8212; Python for Everybody - Interactive</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/matrixeq.css?v=58BC228F" />
    <link rel="stylesheet" type="text/css" href="../_static/webgldemo.css?v=B36B48D" />
    <link rel="stylesheet" type="text/css" href="../_static/webglinteractive.css?v=910DF1E1" />
    <link rel="stylesheet" type="text/css" href="../_static/CodeChat.css" />
    <link rel="stylesheet" type="text/css" href="../_static/accessibility.css?v=50109A2C" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/637.css?v=bddd2011b20db76a20ea" />
    <link rel="stylesheet" type="text/css" href="../_static/runestone.css?v=7c5388ad4389eae1a318" />



    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/matrixeq.js?v=D64CFA5A"></script>
    <script src="../_static/webglinteractive.js?v=2B768384"></script>
    <script src="../_static/FileSaver.min.js?v=8408C997"></script>
    <script src="../_static/html4css1.css?v=4533ACD3"></script>
    <script src="../_static/animationbase.js?v=A043C3A7"></script>
    <script src="../_static/runtime.bundle.js?v=aa7c717c38c5405af9e6"></script>
    <script src="../_static/637.bundle.js?v=1123ad75f9b821cdd636"></script>
    <script src="../_static/runestone.bundle.js?v=9c8e466e8cbed4a3af5a"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="21.7. Basic data modeling" href="basicModeling.html" />
    <link rel="prev" title="21.5. Structured Query Language summary" href="SQLsummary.html" />


<link rel="shortcut icon" href="/runestone/static/favicon.ico" type="image/ico" />


<script>
  eBookConfig = {};
  
    eBookConfig.useRunestoneServices = true;
    eBookConfig.host = 'http://127.0.0.1:8000' || 'http://127.0.0.1:8000';
    eBookConfig.app = eBookConfig.host+'/runestone';
    eBookConfig.course = 'py4e-int';
    eBookConfig.basecourse = 'py4e-int';
    eBookConfig.isLoggedIn = false;
    eBookConfig.enableCompareMe = eBookConfig.useRunestoneServices;
  
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.logLevel = 10;
  eBookConfig.loginRequired = false;
  eBookConfig.build_info = "unknown";
  eBookConfig.python3 = true;
  eBookConfig.acDefaultLanguage = '' ? '' : 'python'
  eBookConfig.runestone_version = '';
  eBookConfig.jobehost = '';
  eBookConfig.proxyuri_runs = '';
  eBookConfig.proxyuri_files = '';
  eBookConfig.enable_chatcodes = false ? false : false;

</script>

<!-- Ad Serving Headers Only serve ads to Anonymous Users -->



  </head><body>


<!-- Begin navbar -->
<div id="navbar" class="navbar navbar-default navbar-fixed-top" role="navigation">

  <div class="container">

    <div class="navbar-header">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type='button' class='navbar-toggle' data-toggle="collapse" data-target=".navbar-ex1-collapse" aria-label="navbar toggle">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div>
        
        
          <a class="brand-logo" href="/runestone/default/user/login" aria-label="Login"><img src="../_static/img/logo_small.png" alt=""></a>
        
        <a class="navbar-brand" href="../index.html" aria-label="index-page">
          
          py4e-int
        </a>
      </div>
    </div>



    <div class="navbar-collapse collapse navbar-ex1-collapse">
      <ul class="nav navbar-nav navbar-right" >

        <li class="divider-vertical"></li>


        <!-- social media dropdown -->
        
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-globe" style="opacity: 0.9"><span class="visuallyhidden" aria-label="Social">Social</span></i>
          </a>
          <ul class="dropdown-menu social-menu">
              <li>
                <div>
                  <b>Runestone in social media:</b>
                </div>
                <a href="https://twitter.com/iRunestone">Follow @iRunestone</a>
                <a href="https://www.facebook.com/RunestoneInteractive">Our Facebook Page</a>
              </li>

              <li class="divider"></li>
              <li>
                <div>
                  <b>Help support us:</b>
                </div>
                <div>
                    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                  <input type="hidden" name="cmd" value="_s-xclick">
                  <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
                  ">
                  <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
                  <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
                  </form>

                </div>
              </li>
          </ul>
        </li><!-- end social media dropdown -->

        <li class="divider-vertical"></li>

        <!-- search dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-search" style='opacity:0.9;'><span class="visuallyhidden" aria-label="Search">Search</span></i>
          </a>
          <ul class='dropdown-menu'>
            
                <li><a href='../index.html' aria-label="index-page">Table of Contents</a></li>
            
            <li><a href='../genindex.html'>Book Index</a></li>
            <li class="divider"></li>
            <li style="width: 240px;">
              <form class="navbar-search" style="margin:10px;" action="../search.html" method="get">
                <div class="input-group">
                  <input type="text" class="form-control" name="q" placeholder="Search this book" />
                  <span class="input-group-btn">
                    <button class="btn btn-primary" style="margin:0;" type="submit">
                      <i class="glyphicon glyphicon-search"></i>
                    </button>
                  </span>
                </div><!-- /input-group -->
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
            </li>
          </ul>
        </li>
        <!-- end search dropdown -->

        <li class="divider-vertical"></li>

        
        <!-- user account dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-user" style="opacity:0.9;"><span class="visuallyhidden" aria-label="User">User</span></i>
          </a>
          <ul class="dropdown-menu user-menu">
            <li><span class='loggedinuser'></span></li>
            <li class="divider"></li>
            <li><a href='/runestone/assignments/chooseAssignment.html'>Assignments</a></li>
            <li><a href='/runestone/assignments/practice'>Practice</a></li>
            <li class="divider"></li>
            
            <li><a href='/runestone/default/courses'>Change Course</a></li>
			      <li class="divider"></li>
            <li id="ip_dropdown_link"><a href='/runestone/admin/index'>Instructor's Page</a></li>
            
            <li><a href='/runestone/dashboard/studentreport'>Progress Page</a></li>
            <li class="divider"></li>
            
            <li><a href="/runestone/default/user/profile" id="profilelink">Edit Profile</a></li>
            <li><a href="/runestone/default/user/change_password" id="passwordlink">Change Password</a></li>
            <li><a href="/runestone/default/user/register" id="registerlink">Register</a></li>
            
            <li class='loginout'><a href='#'>Login</a></li> <!-- correct link populated by addNavbarLoginLink() -->
			<!-- dark mode toggle -->
             <li><label class="theme-switch" for="checkbox">
					  <input type="checkbox" id="checkbox" onchange="runestoneComponents.switchTheme()" />
							<div class="slider round"></div>
					</label>Dark Mode</li>
			 </ul>
        </li>
        <!-- end user account dropdown -->
        
        <li class="divider-vertical"></li>
        <!-- <li id="scratch_ac_link"><a href="javascript:ACFactory.toggleScratchActivecode()">Scratch ActiveCode</a></li> -->

        <!-- <li class="dropdown">             -->
          <li id="scratch_ac_link" class="dropdown"><a href="javascript:runestoneComponents.popupScratchAC()">
              <i class="glyphicon glyphicon-pencil" style="opacity:0.9;"><span class="visuallyhidden" aria-label="Scratch Activecode" >Scratch Activecode</span></i></a></li>
        <!-- </li> -->

        <li class="divider-vertical"></li>

        
        <!-- help menu dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-question-sign" style="opacity:0.9;"><span class="visuallyhidden" aria-label="Help">Help</span></i>
          </a>
          <ul class="dropdown-menu user-menu">
            <li><a href='http://runestoneinteractive.org/pages/faq.html'>FAQ</a></li>
            <li><a href='https://runestone.academy/runestone/static/instructorguide/index.html'>Instructors Guide</a></li>
            <li class="divider"></li>
            <li><a href='http://runestoneinteractive.org'>About Runestone</a></li>
            <li><a href='/runestone/default/reportabug?course=py4e-int&page=spideringTwitter'>Report A Problem</a></li>
          </ul>
        </li>
        <!-- end help menu dropdown -->

        <li class="divider-vertical"></li>
      
      </ul>

      <ul class="nav navbar-nav">
        <li class="divider-vertical"></li>
        
          
          <li class="divider-vertical"></li>
        
        <!-- 
          
  <li id="relations-prev" title="Previous Chapter - <span class="section-number">21.5. </span>Structured Query Language summary" data-toggle="tooltip">
    <a href="SQLsummary.html" >
      <i class='glyphicon glyphicon-backward' style='opacity:0.9;'></i>
    </a>
  </li>
  
  <li id="relations-next" title='Next Chapter - <span class="section-number">21.7. </span>Basic data modeling' data-toggle="tooltip" >              
    <a href="basicModeling.html" >
        <i class='glyphicon glyphicon-forward' style='opacity:0.9;'></i>
    </a>
  </li>
  <li class="divider-vertical"></li>

<script>
  opts = {'placement':'bottom',
          'selector': '',
          'delay': { show: 100, hide: 50}
         };

  window.addEventListener('load', (event) => {
    $('#relations-prev').tooltip(opts);
    $('#relations-next').tooltip(opts);
  });
</script>
        -->
        
          <li></li>
        
      </ul>
      </div> <!-- navbar-collapse -->
    </div> <!-- navbar -->
  </div> <!-- container -->


<div class="container" id="continue-reading"></div>

<div class="container" id="main-content" role="main">
  
<!-- Ad Serving for Runestone Campaign -->


  
  <div class="section" id="spidering-twitter-using-a-database">
<h1><span class="section-number">21.6. </span>Spidering Twitter using a database<a class="headerlink" href="#spidering-twitter-using-a-database" title="Permalink to this headline">¶</a></h1>
<div class="admonition note" id="index-0">
<p class="admonition-title">Note</p>
<p>Spidering Twitter uses the API mentioned earlier. This requires a developer
account, which you may or may not be granted. If you are running this
program, be very careful – you do not want to pull too much data or run
the program for too long and end up having your Twitter access shut off.</p>
</div>
<p>In this section, we will create a simple spidering program that will go
through Twitter accounts and build a database of them.</p>
<p>One of the problems of any kind of spidering program is that it needs to
be able to be stopped and restarted many times and you do not want to
lose the data that you have retrieved so far. You don’t want to always
restart your data retrieval at the very beginning so we want to store
data as we retrieve it so our program can start back up and pick up
where it left off.</p>

            <div class="runestone alert alert-warning">
            <ul data-component="multiplechoice" data-question_label="21.6.1" data-multipleanswers="false"  id="dbTwitter_MC1"  style="visibility: hidden;">
            <p>Q-1: Which of the following is a problem with spidering programs?</p>

            <li data-component="answer" data-correct id="dbTwitter_MC1_opt_a">Spidering programs need to be stopped and restarted frequently.</li><li data-component="feedback">One of the problems of any kind of spidering program is that it needs to be able to be stopped and restarted many times and you do not want to lose the data that you have retrieved so far.</li>
            
            <li data-component="answer"  id="dbTwitter_MC1_opt_b">Spidering programs are time consuming to run.</li><li data-component="feedback">Spidering programs are usually pretty simple and able to run consecutively, but the timing depends on your data.</li>
            
            <li data-component="answer"  id="dbTwitter_MC1_opt_c">Spidering programs cannot be restarted.</li><li data-component="feedback">Spidering programs can be restarted from where they leave off.</li>
            

            </ul>
            </div>
            <p>We will start by retrieving one person’s Twitter friends and their
statuses, looping through the list of friends, and adding each of the
friends to a database to be retrieved in the future. After we process
one person’s Twitter friends, we check in our database and retrieve one
of the friends of the friend. We do this over and over, picking an
“unvisited” person, retrieving their friend list, and adding friends we
have not seen to our list for a future visit.</p>

            <div class="runestone alert alert-warning">
            <ul data-component="multiplechoice" data-question_label="21.6.2" data-multipleanswers="false"  id="dbTwitter_MC_tf1"  style="visibility: hidden;">
            <p>Q-2: True or False? Spidering programs make user of loops to filter through data.</p>

            <li data-component="answer" data-correct id="dbTwitter_MC_tf1_opt_a">True</li><li data-component="feedback">By using loops, a spidering program can quickly scroll through each data entry.</li>
            
            <li data-component="answer"  id="dbTwitter_MC_tf1_opt_b">False</li><li data-component="feedback">Try again!</li>
            

            </ul>
            </div>
            <p>We also track how many times we have seen a particular friend in the
database to get some sense of their “popularity”.</p>
<p>By storing our list of known accounts and whether we have retrieved the
account or not, and how popular the account is in a database on the disk
of the computer, we can stop and restart our program as many times as we
like.</p>

            <div class="runestone alert alert-warning">
            <ul data-component="multiplechoice" data-question_label="21.6.3" data-multipleanswers="false"  id="dbTwitter_MC_tf2"  style="visibility: hidden;">
            <p>Q-3: True or False? Programs using databases may be stopped and restarted, but do not retain the data.</p>

            <li data-component="answer"  id="dbTwitter_MC_tf2_opt_a">True</li><li data-component="feedback">Try again!</li>
            
            <li data-component="answer" data-correct id="dbTwitter_MC_tf2_opt_b">False</li><li data-component="feedback">Using databases can be very helpful, as they retain run data each time a program is stopped and restarted.</li>
            

            </ul>
            </div>
            <p>This program is a bit complex. It is based on the code from the exercise
earlier in the book that uses the Twitter API.</p>
<p>Here is the source code for our Twitter spidering application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="kn">import</span> <span class="nn">urllib.error</span>
<span class="kn">import</span> <span class="nn">twurl</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">ssl</span>

<span class="n">TWITTER_URL</span> <span class="o">=</span> <span class="s1">&#39;https://api.twitter.com/1.1/friends/list.json&#39;</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;spider.sqlite&#39;</span><span class="p">)</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            CREATE TABLE IF NOT EXISTS Twitter</span>
<span class="s1">            (name TEXT, retrieved INTEGER, friends INTEGER)&#39;&#39;&#39;</span><span class="p">)</span>

<span class="c1"># Ignore SSL certificate errors</span>
<span class="n">ctx</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">check_hostname</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_NONE</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">acct</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter a Twitter account, or quit: &#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">acct</span> <span class="o">==</span> <span class="s1">&#39;quit&#39;</span><span class="p">):</span> <span class="k">break</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">acct</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT name FROM Twitter WHERE retrieved = 0 LIMIT 1&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">acct</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No unretrieved Twitter accounts found&#39;</span><span class="p">)</span>
            <span class="k">continue</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">twurl</span><span class="o">.</span><span class="n">augment</span><span class="p">(</span><span class="n">TWITTER_URL</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;screen_name&#39;</span><span class="p">:</span> <span class="n">acct</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="s1">&#39;20&#39;</span><span class="p">})</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Retrieving&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">ctx</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">getheaders</span><span class="p">())</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Remaining&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;x-rate-limit-remaining&#39;</span><span class="p">])</span>
    <span class="n">js</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="c1"># Debugging</span>
    <span class="c1"># print json.dumps(js, indent=4)</span>

    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;UPDATE Twitter SET retrieved=1 WHERE name = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">acct</span><span class="p">,</span> <span class="p">))</span>

    <span class="n">countnew</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">countold</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">js</span><span class="p">[</span><span class="s1">&#39;users&#39;</span><span class="p">]:</span>
        <span class="n">friend</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">friend</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT friends FROM Twitter WHERE name = ? LIMIT 1&#39;</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">friend</span><span class="p">,</span> <span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;UPDATE Twitter SET friends = ? WHERE name = ?&#39;</span><span class="p">,</span>
                        <span class="p">(</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">friend</span><span class="p">))</span>
            <span class="n">countold</span> <span class="o">=</span> <span class="n">countold</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;INSERT INTO Twitter (name, retrieved, friends)</span>
<span class="s1">                        VALUES (?, 0, 1)&#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">friend</span><span class="p">,</span> <span class="p">))</span>
            <span class="n">countnew</span> <span class="o">=</span> <span class="n">countnew</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New accounts=&#39;</span><span class="p">,</span> <span class="n">countnew</span><span class="p">,</span> <span class="s1">&#39; revisited=&#39;</span><span class="p">,</span> <span class="n">countold</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Our database is stored in the file <code class="docutils literal notranslate"><span class="pre">spider.sqlite3</span></code> and it
has one table named <code class="docutils literal notranslate"><span class="pre">Twitter</span></code>. Each row in the
<code class="docutils literal notranslate"><span class="pre">Twitter</span></code> table has a column for the account name, whether we
have retrieved the friends of this account, and how many times this
account has been “friended”.</p>
<p>In the main loop of the program, we prompt the user for a Twitter
account name or “quit” to exit the program. If the user enters a Twitter
account, we retrieve the list of friends and statuses for that user and
add each friend to the database if not already in the database. If the
friend is already in the list, we add 1 to the <code class="docutils literal notranslate"><span class="pre">friends</span></code>
field in the row in the database.</p>
<p>If the user presses enter, we look in the database for the next Twitter
account that we have not yet retrieved, retrieve the friends and
statuses for that account, add them to the database or update them, and
increase their <code class="docutils literal notranslate"><span class="pre">friends</span></code> count.</p>
<p>Once we retrieve the list of friends and statuses, we loop through all
of the <code class="docutils literal notranslate"><span class="pre">user</span></code> items in the returned JSON and retrieve the
<code class="docutils literal notranslate"><span class="pre">screen_name</span></code> for each user. Then we use the <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>
statement to see if we already have stored this particular <code class="docutils literal notranslate"><span class="pre">screen_name</span></code>
in the database and retrieve the friend count (<code class="docutils literal notranslate"><span class="pre">friends</span></code>) if
the record exists.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">countnew</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">countold</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">js</span><span class="p">[</span><span class="s1">&#39;users&#39;</span><span class="p">]</span> <span class="p">:</span>
    <span class="n">friend</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="s1">&#39;screen_name&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">friend</span><span class="p">)</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT friends FROM Twitter WHERE name = ? LIMIT 1&#39;</span><span class="p">,</span>
        <span class="p">(</span><span class="n">friend</span><span class="p">,</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;UPDATE Twitter SET friends = ? WHERE name = ?&#39;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">friend</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">countold</span> <span class="o">=</span> <span class="n">countold</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;INSERT INTO Twitter (name, retrieved, friends)</span>
<span class="s1">            VALUES ( ?, 0, 1 )&#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span> <span class="n">friend</span><span class="p">,</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">countnew</span> <span class="o">=</span> <span class="n">countnew</span> <span class="o">+</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New accounts=&#39;</span><span class="p">,</span><span class="n">countnew</span><span class="p">,</span><span class="s1">&#39; revisited=&#39;</span><span class="p">,</span><span class="n">countold</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<p>Once the cursor executes the <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statement, we must
retrieve the rows. We could do this with a <code class="docutils literal notranslate"><span class="pre">for</span></code> statement,
but since we are only retrieving one row (<code class="docutils literal notranslate"><span class="pre">LIMIT</span> <span class="pre">1</span></code>), we can
use the <code class="docutils literal notranslate"><span class="pre">fetchone()</span></code> method to fetch the first (and only) row
that is the result of the <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> operation. Since
<code class="docutils literal notranslate"><span class="pre">fetchone()</span></code> returns the row as a <em>tuple</em>
(even though there is only one field), we take the first value from the
tuple using to get the current friend count into the variable
<code class="docutils literal notranslate"><span class="pre">count</span></code>.</p>
<p>If this retrieval is successful, we use the SQL <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>
statement with a <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> clause to add 1 to the
<code class="docutils literal notranslate"><span class="pre">friends</span></code> column for the row that matches the friend’s
account. Notice that there are two placeholders (i.e., question marks)
in the SQL, and the second parameter to the <code class="docutils literal notranslate"><span class="pre">execute()</span></code> is a
two-element tuple that holds the values to be substituted into the SQL
in place of the question marks.</p>
<p>If the code in the <code class="docutils literal notranslate"><span class="pre">try</span></code> block fails, it is probably because
no record matched the <code class="docutils literal notranslate"><span class="pre">WHERE</span> <span class="pre">name</span> <span class="pre">=</span> <span class="pre">?</span></code> clause on the SELECT
statement. So in the <code class="docutils literal notranslate"><span class="pre">except</span></code> block, we use the SQL
<code class="docutils literal notranslate"><span class="pre">INSERT</span></code> statement to add the friend’s <code class="docutils literal notranslate"><span class="pre">screen_name</span></code> to the
table with an indication that we have not yet retrieved the
<code class="docutils literal notranslate"><span class="pre">screen_name</span></code> and set the friend count to zero.</p>
<p>So the first time the program runs and we enter a Twitter account, the
program runs as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Enter</span> <span class="n">a</span> <span class="n">Twitter</span> <span class="n">account</span><span class="p">,</span> <span class="ow">or</span> <span class="n">quit</span><span class="p">:</span> <span class="n">drchuck</span>
<span class="n">Retrieving</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">twitter</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="mf">1.1</span><span class="o">/</span><span class="n">friends</span> <span class="o">...</span>
<span class="n">New</span> <span class="n">accounts</span><span class="o">=</span> <span class="mi">20</span>  <span class="n">revisited</span><span class="o">=</span> <span class="mi">0</span>
<span class="n">Enter</span> <span class="n">a</span> <span class="n">Twitter</span> <span class="n">account</span><span class="p">,</span> <span class="ow">or</span> <span class="n">quit</span><span class="p">:</span> <span class="n">quit</span>
</pre></div>
</div>
<p>Since this is the first time we have run the program, the database is
empty and we create the database in the file <code class="docutils literal notranslate"><span class="pre">spider.sqlite3</span></code>
and add a table named <code class="docutils literal notranslate"><span class="pre">Twitter</span></code> to the database. Then we
retrieve some friends and add them all to the database since the
database is empty.</p>
<p>At this point, we might want to write a simple database dumper to take a
look at what is in our <code class="docutils literal notranslate"><span class="pre">spider.sqlite3</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;spider.sqlite&#39;</span><span class="p">)</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM Twitter&#39;</span><span class="p">)</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="s1">&#39;rows.&#39;</span><span class="p">)</span>
<span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>This program simply opens the database and selects all of the columns of
all of the rows in the table <code class="docutils literal notranslate"><span class="pre">Twitter</span></code>, then loops through
the rows and prints out each row.</p>
<p>If we run this program after the first execution of our Twitter spider
above, its output will be as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;opencontent&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;lhawthorn&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;steve_coppin&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;davidkocher&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;hrheingold&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">...</span>
<span class="mi">20</span> <span class="n">rows</span><span class="o">.</span>
</pre></div>
</div>
<p>We see one row for each <code class="docutils literal notranslate"><span class="pre">screen_name</span></code>, that we have not retrieved the
data for that <code class="docutils literal notranslate"><span class="pre">screen_name</span></code>, and everyone in the database has one
friend.</p>
<p>Now our database reflects the retrieval of the friends of our first
Twitter account (<em>drchuck</em>). We can run the program again
and tell it to retrieve the friends of the next “unprocessed” account by
simply pressing enter instead of a Twitter account as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Enter</span> <span class="n">a</span> <span class="n">Twitter</span> <span class="n">account</span><span class="p">,</span> <span class="ow">or</span> <span class="n">quit</span><span class="p">:</span>
<span class="n">Retrieving</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">twitter</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="mf">1.1</span><span class="o">/</span><span class="n">friends</span> <span class="o">...</span>
<span class="n">New</span> <span class="n">accounts</span><span class="o">=</span> <span class="mi">18</span>  <span class="n">revisited</span><span class="o">=</span> <span class="mi">2</span>
<span class="n">Enter</span> <span class="n">a</span> <span class="n">Twitter</span> <span class="n">account</span><span class="p">,</span> <span class="ow">or</span> <span class="n">quit</span><span class="p">:</span>
<span class="n">Retrieving</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">twitter</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="mf">1.1</span><span class="o">/</span><span class="n">friends</span> <span class="o">...</span>
<span class="n">New</span> <span class="n">accounts</span><span class="o">=</span> <span class="mi">17</span>  <span class="n">revisited</span><span class="o">=</span> <span class="mi">3</span>
<span class="n">Enter</span> <span class="n">a</span> <span class="n">Twitter</span> <span class="n">account</span><span class="p">,</span> <span class="ow">or</span> <span class="n">quit</span><span class="p">:</span> <span class="n">quit</span>
</pre></div>
</div>
<p>Since we pressed enter (i.e., we did not specify a Twitter account), the
following code is executed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">acct</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">:</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT name FROM Twitter WHERE retrieved = 0 LIMIT 1&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">acct</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No unretrieved twitter accounts found&#39;</span><span class="p">)</span>
        <span class="k">continue</span>
</pre></div>
</div>
<p>We use the SQL <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statement to retrieve the name of the
first (<code class="docutils literal notranslate"><span class="pre">LIMIT</span> <span class="pre">1</span></code>) user who still has their “have we retrieved
this user” value set to zero. We also use the <code class="docutils literal notranslate"><span class="pre">fetchone()[0]</span></code>
pattern within a try/except block to either extract a <code class="docutils literal notranslate"><span class="pre">screen_name</span></code> from
the retrieved data or put out an error message and loop back up.</p>
<p>If we successfully retrieved an unprocessed <code class="docutils literal notranslate"><span class="pre">screen_name</span></code>, we retrieve
their data as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">url</span><span class="o">=</span><span class="n">twurl</span><span class="o">.</span><span class="n">augment</span><span class="p">(</span><span class="n">TWITTER_URL</span><span class="p">,{</span><span class="s1">&#39;screen_name&#39;</span><span class="p">:</span> <span class="n">acct</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="s1">&#39;20&#39;</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Retrieving&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">js</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;UPDATE Twitter SET retrieved=1 WHERE name = ?&#39;</span><span class="p">,(</span><span class="n">acct</span><span class="p">,</span> <span class="p">))</span>
</pre></div>
</div>
<p>Once we retrieve the data successfully, we use the <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>
statement to set the <code class="docutils literal notranslate"><span class="pre">retrieved</span></code> column to 1 to indicate that
we have completed the retrieval of the friends of this account. This
keeps us from retrieving the same data over and over and keeps us
progressing forward through the network of Twitter friends.</p>
<p>If we run the friend program and press enter twice to retrieve the next
unvisited friend’s friends, then run the dumping program, it will give
us the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;opencontent&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;lhawthorn&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;steve_coppin&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;davidkocher&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;hrheingold&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">...</span>
<span class="p">(</span><span class="s1">&#39;cnxorg&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;knoop&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;kthanos&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;LectureTools&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">...</span>
<span class="mi">55</span> <span class="n">rows</span><span class="o">.</span>
</pre></div>
</div>
<p>We can see that we have properly recorded that we have visited
<code class="docutils literal notranslate"><span class="pre">lhawthorn</span></code> and <code class="docutils literal notranslate"><span class="pre">opencontent</span></code>. Also the accounts
<code class="docutils literal notranslate"><span class="pre">cnxorg</span></code> and <code class="docutils literal notranslate"><span class="pre">kthanos</span></code> already have two followers.
Since we now have retrieved the friends of three people
(<code class="docutils literal notranslate"><span class="pre">drchuck</span></code>, <code class="docutils literal notranslate"><span class="pre">opencontent</span></code>, and
<code class="docutils literal notranslate"><span class="pre">lhawthorn</span></code>) our table has 55 rows of friends to retrieve.</p>
<p>Each time we run the program and press enter it will pick the next
unvisited account (e.g., the next account will be <code class="docutils literal notranslate"><span class="pre">steve_coppin</span></code>),
retrieve their friends, mark them as retrieved, and for each of the
friends of <code class="docutils literal notranslate"><span class="pre">steve_coppin</span></code> either add them to the end of the database or
update their friend count if they are already in the database.</p>
<p>Since the program’s data is all stored on disk in a database, the
spidering activity can be suspended and resumed as many times as you
like with no loss of data.</p>
</div>


  <div id="scprogresscontainer">
    You have attempted <span id="scprogresstotal"></span> of <span id="scprogressposs"></span> activities on this page <div id="subchapterprogress" aria-label="Page progress"></div>
  </div>

  <ul role="navigation" class="nextprev-list nextprev-list" aria-label="Change page">
<li id="relations-prev" class="navLink" title='Previous Section - 21.5. Structured Query Language summary' data-toggle="tooltip">
  <a href="SQLsummary.html" aria-label="Previous - 21.5. Structured Query Language summary">
    <i class='prevNav glyphicon glyphicon-chevron-left'  style="top:50%; transform:translateY(-50%)translateX(-50%); left: 50%; color:black;"></i>
  </a>
</li>

  <li id="relations-next" class="navLink" title='Next Section - 21.7. Basic data modeling' data-toggle="tooltip" >
    <a href="basicModeling.html" aria-label="Next - 21.7. Basic data modeling">
      <i id="relationsNextIcon" class='nextNav glyphicon glyphicon-chevron-right' style="top:50%; transform:translateY(-50%)translateX(-50%); left: 50%; color:black; "></i>
    </a>
  </li>
</ul>

<script>
window.addEventListener('load', (event) => {
  $('#relations-prev').tooltip({'placement': 'right', 'delay': { show: 100, hide: 50}});
  $('#relations-next').tooltip({'placement': 'left', 'delay': { show: 100, hide: 50}});
});
</script>
  
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      
      
      <span id='numuserspan'></span><span class='loggedinuser'></span>
      
      
      | <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020 - Based on Python for Everybody.
      Created using <a href="http://runestoneinteractive.org/">Runestone</a> .
    </p>
  </div>
</footer>




<script> 
  window.addEventListener('load', (event) => {
    runestoneComponents.getSwitch(); 
  });
</script>


  </body>
</html>